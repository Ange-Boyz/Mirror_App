<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#071428" />
  <title>Life Mirror ‚Äî R√©flexion sur le Temps</title>
  <style>
    /* ---------------------------------------------
       Life Mirror ‚Äî Responsive, mobile-first
       Improvements: accessibility, touch targets, fluid grid,
       reduced visual noise on small screens, keyboard support
       ----------------------------------------------*/
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;800&display=swap');

    :root{
      --bg-0:#071428; --bg-1:#0b1626; --bg-2:#0f2438; --card:#0f2234;
      --muted:#98a3bd; --text:#e6eef6; --accent:#2b8eff; --accent-2:#60a5fa; --success:#10b981;
      --glass:rgba(255,255,255,0.03); --glass-2:rgba(255,255,255,0.02); --focus: rgba(43,142,255,0.18);
      --shadow: rgba(0,0,0,0.45);
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:'Inter',system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial;color:var(--text);background:linear-gradient(180deg,var(--bg-0),var(--bg-1));-webkit-font-smoothing:antialiased}

    /* Layout container */
    .container{max-width:1100px;margin:0 auto;padding:18px;min-height:100vh;display:flex;flex-direction:column;gap:18px}

    /* Header */
    .app-header{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px;border-radius:14px;background:linear-gradient(180deg,var(--card),rgba(255,255,255,0.02));border:1px solid var(--glass);box-shadow:0 6px 20px var(--shadow);}
    .logo-section{display:flex;align-items:center;gap:12px;min-width:0}
    .logo{width:44px;height:44px;border-radius:10px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:grid;place-items:center;box-shadow:0 8px 24px rgba(43,142,255,0.18)}
    .logo svg{width:26px;height:26px;fill:white}
    .title-group{min-width:0}
    .title-group h1{font-size:1.05rem;margin:0;font-weight:800;line-height:1;color:var(--text)}
    .title-group p{margin:0;color:var(--muted);font-size:0.85rem}

    .lang-toggle{display:flex;gap:8px}
    .lang-toggle button{padding:8px 10px;border-radius:10px;background:transparent;border:1px solid transparent;color:var(--muted);font-weight:700;cursor:pointer}
    .lang-toggle button.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;border-color:rgba(99,179,255,0.12)}

    /* Main area: mobile-first stack */
    .main{display:flex;flex-direction:column;gap:14px}

    .panel{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:14px;padding:14px;border:1px solid var(--glass)}

    /* Sidebar (stacked above on mobile) */
    .sidebar{display:flex;flex-direction:column;gap:12px}
    .sidebar .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:0.85rem;color:var(--muted);font-weight:600}
    input[type=text],input[type=number],textarea,select{padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:var(--text);outline:none;font-size:0.95rem}
    input:focus,textarea:focus{box-shadow:0 6px 18px var(--focus);border-color:var(--accent)}
    textarea{min-height:90px;resize:vertical}

    /* Steps row (horizontal scroll on mobile) */
    .steps{display:flex;gap:8px;overflow:auto;padding:6px 2px;align-items:center}
    .steps::-webkit-scrollbar{height:6px}
    .step{min-width:40px;height:40px;border-radius:10px;background:transparent;border:1px solid var(--glass);display:grid;place-items:center;color:var(--muted);font-weight:700;cursor:pointer;padding:6px}
    .step.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;border-color:transparent;box-shadow:0 8px 24px rgba(43,142,255,0.12);transform:translateY(-2px)}
    .step.completed{background:linear-gradient(90deg,var(--success),#059669);color:white}

    /* Question area */
    .question{padding:8px 0}
    .question h3{font-size:1rem;margin:0 0 10px 0;color:var(--text);line-height:1.35}
    .options-grid{display:grid;grid-template-columns:1fr;gap:10px}
    .option-btn{padding:12px;border-radius:10px;border:1px solid var(--glass);background:transparent;color:var(--text);font-weight:700;cursor:pointer;text-align:center}
    .option-btn.active{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white;box-shadow:0 8px 20px rgba(43,142,255,0.12);transform:translateY(-2px)}

    /* Controls fixed bottom for mobile (improves reachability) */
    .controls{display:flex;gap:10px;margin-top:12px}
    .btn{flex:1;padding:12px 14px;border-radius:12px;border:0;font-weight:800;cursor:pointer}
    .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:white}
    .btn-ghost{background:transparent;border:1px solid var(--glass);color:var(--text)}

    /* Life visual grid (smaller on mobile) */
    .life-visual{display:flex;flex-direction:column;gap:10px}
    .life-visual .grid{display:grid;grid-template-columns:repeat(26, 1fr);gap:3px}
    .cell{aspect-ratio:1/1;border-radius:3px;background:var(--glass);transition:all 0.18s ease}
    .cell.past{background:linear-gradient(135deg,#123b7a,#083066);box-shadow:0 0 6px rgba(30,64,175,0.16)}
    .cell.now{background:linear-gradient(90deg,var(--accent),var(--accent-2));box-shadow:0 0 10px rgba(43,142,255,0.24);animation:pulse 2.2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1);opacity:1}50%{transform:scale(1.08);opacity:0.9}}

    /* Stats card */
    .stats{display:flex;flex-direction:column;align-items:center;gap:6px;padding:12px;border-radius:10px;background:linear-gradient(90deg,var(--accent),var(--accent-dark));color:white}
    .stats .value{font-size:1.8rem;font-weight:800}
    .stats .label{font-size:0.85rem;opacity:0.95}

    /* Report area */
    .report{display:none;flex-direction:column;gap:12px}
    .report .card{padding:16px}
    .report ul{list-style:none;padding:0;margin:0;display:flex;flex-direction:column;gap:8px}
    .report li{padding:10px;border-radius:8px;background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-left:3px solid var(--accent)}
    .advice{padding:12px;border-radius:10px;background:linear-gradient(90deg,var(--success),#059669);color:white;font-weight:700}

    /* footer */
    footer{color:var(--muted);font-size:0.85rem;text-align:center;padding:6px}

    /* Larger screens layout */
    @media(min-width:880px){
      .main{flex-direction:row;align-items:flex-start;gap:20px}
      .sidebar{width:320px;flex-shrink:0}
      .content-panel{flex:1}
      .steps{justify-content:flex-start}
      .life-visual .grid{grid-template-columns:repeat(52, 1fr)}
    }

    @media(min-width:1100px){.container{max-width:1150px}}
  </style>
</head>
<body>
  <div class="container" id="app">
    <header class="app-header" role="banner">
      <div class="logo-section">
        <div class="logo" aria-hidden>
          <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/></svg>
        </div>
        <div class="title-group">
          <h1>Life Mirror</h1>
          <p>Un outil introspectif pour te donner conscience du temps</p>
        </div>
      </div>

      <div class="lang-toggle" role="radiogroup" aria-label="Choisir la langue">
        <button id="langFr" class="active" role="radio" aria-checked="true">FR</button>
        <button id="langEn" role="radio" aria-checked="false">EN</button>
      </div>
    </header>

    <main class="main" role="main">
      <!-- Sidebar (stacked on mobile) -->
      <aside class="sidebar panel" aria-label="Param√®tres utilisateur">
        <div class="field">
          <label for="inputName">Nom</label>
          <input id="inputName" type="text" placeholder="Ex: Ange" inputmode="text" />
        </div>

        <div class="field">
          <label for="inputAge">√Çge actuel</label>
          <input id="inputAge" type="number" min="0" max="130" value="20" inputmode="numeric" />
        </div>

        <div class="field">
          <label for="inputDeath">√Çge estim√© pour mourir</label>
          <input id="inputDeath" type="number" min="1" max="140" value="80" inputmode="numeric" />
        </div>

        <div class="stats" aria-live="polite">
          <div class="value" id="quickPercent">0%</div>
          <div class="label" id="statsLabel">de ta vie v√©cue</div>
          <div class="label" id="quickLeft">0 semaines restantes</div>
        </div>

        <div class="life-visual" aria-hidden="false">
          <div class="life-visual-title">Aper√ßu de la vie</div>
          <div class="grid" id="gridPreview" aria-hidden="true"></div>
        </div>
      </aside>

      <!-- Questions panel -->
      <section class="content-panel panel" aria-labelledby="questionTitle">
        <div class="steps" id="steps" role="tablist" aria-label="√âtapes"></div>

        <div id="stepContent" aria-live="polite"></div>

        <div class="controls" aria-hidden="false">
          <button id="prevBtn" class="btn btn-ghost" aria-label="Pr√©c√©dent" disabled>‚Üê <span id="prevText">Pr√©c√©dent</span></button>
          <button id="nextBtn" class="btn btn-primary" aria-label="Suivant"> <span id="nextText">Suivant</span> ‚Üí</button>
        </div>
      </section>
    </main>

    <!-- Final Report -->
    <section id="finalReport" class="panel report" aria-live="polite">
      <div class="card" id="reportCard" style="display:none">
        <h2 id="reportTitle">Rapport & Conseils</h2>
        <div id="reportContent"></div>
        <div class="advice" id="finalAdvice"></div>
        <div style="display:flex;gap:8px;margin-top:12px;">
          <button id="downloadJSON" class="btn btn-ghost">üíæ <span id="downloadText">T√©l√©charger</span></button>
          <button id="restart" class="btn btn-primary">üîÑ <span id="restartText">Recommencer</span></button>
        </div>
      </div>
    </section>

    <footer><small>Life Mirror ‚Ä¢ Tes r√©ponses sont stock√©es localement dans ton navigateur</small></footer>
  </div>

  <script>
    // Questions content (FR/EN)
    const Q = {
      fr: [
        {id:'q_regret', title:"Si tu mourais cette ann√©e, quel serait ton plus grand regret ?", type:'textarea', placeholder:'Ex: Ne pas avoir essay√© mon projet'},
        {id:'q_loved', title:"As-tu des personnes qui t'aiment r√©ellement aujourd'hui ?", type:'options', options:['Oui','Un peu','Je ne sais pas','Non']},
        {id:'q_last_thanks', title:"Quand as-tu dit 'merci' ou 'je t'aime' pour la derni√®re fois ?", type:'text', placeholder:'Ex: Hier, il y a 1 semaine...'},
        {id:'q_dream', title:"As-tu un r√™ve que tu repousses depuis longtemps ? Lequel ?", type:'textarea'},
        {id:'q_project', title:"Si tu avais 5 ans √† vivre, quel projet commencerais-tu demain ?", type:'textarea'},
        {id:'q_pride', title:"Es-tu fier(e) de la personne que tu deviens ?", type:'options', options:['Oui','Presque','Pas vraiment','Pas du tout']},
        {id:'q_health', title:"Comment te sens-tu physiquement ces derniers mois ?", type:'textarea'},
        {id:'q_habit', title:"Quelle habitude simple pourrait am√©liorer ta vie ? (ex: marcher 20 min)", type:'text', placeholder:'Ex: marcher 20 min par jour'},
        {id:'q_fear', title:"Qu'est-ce qui te fait le plus peur dans la vie aujourd'hui ?", type:'textarea'},
        {id:'q_commit', title:"En 1 phrase : Quel est le premier petit pas que tu peux faire demain ?", type:'text', placeholder:'Ex: √©crire 15 min sur mon projet'}
      ],
      en: [
        {id:'q_regret', title:"If you died this year, what would be your biggest regret?", type:'textarea', placeholder:'E.g. Not trying my project'},
        {id:'q_loved', title:"Do you have people who truly love you today?", type:'options', options:['Yes','Somewhat','I don\'t know','No']},
        {id:'q_last_thanks', title:"When did you last say 'thank you' or 'I love you'?", type:'text', placeholder:'E.g. Yesterday, a week ago...'},
        {id:'q_dream', title:"Do you have a dream you've been postponing? Which one?", type:'textarea'},
        {id:'q_project', title:"If you had 5 years to live, which project would you start tomorrow?", type:'textarea'},
        {id:'q_pride', title:"Are you proud of who you are becoming?", type:'options', options:['Yes','Almost','Not really','Not at all']},
        {id:'q_health', title:"How have you been feeling physically these past months?", type:'textarea'},
        {id:'q_habit', title:"Which simple habit could improve your life?", type:'text', placeholder:'E.g. walk 20 min daily'},
        {id:'q_fear', title:"What scares you most in life today?", type:'textarea'},
        {id:'q_commit', title:"In one sentence: What's the first small step you can take tomorrow?", type:'text', placeholder:'E.g. write 15 minutes about my idea'}
      ]
    };

    // state
    let lang = 'fr';
    let stepIndex = 0;
    const answers = {};
    const completed = new Set();

    // elements
    const el = id => document.getElementById(id);
    const langFr = el('langFr'), langEn = el('langEn');

    // language toggle
    function setLang(l){
      lang = l;
      langFr.classList.toggle('active', l==='fr');
      langEn.classList.toggle('active', l==='en');
      renderSteps(); renderStepContent(); updatePreview(); updateStaticTexts();
    }
    langFr.addEventListener('click', ()=>setLang('fr'));
    langEn.addEventListener('click', ()=>setLang('en'));

    function updateStaticTexts(){
      const fr = lang==='fr';
      el('prevText').textContent = fr? 'Pr√©c√©dent' : 'Previous';
      el('nextText').textContent = fr? 'Suivant' : 'Next';
      el('downloadText').textContent = fr? 'T√©l√©charger' : 'Download';
      el('restartText').textContent = fr? 'Recommencer' : 'Restart';
      el('reportTitle').textContent = fr? 'Rapport & Conseils' : 'Report & Advice';
      el('statsLabel').textContent = fr? 'de ta vie v√©cue' : 'of your life lived';
    }

    // steps UI
    function renderSteps(){
      const container = el('steps'); container.innerHTML='';
      const qs = Q[lang];
      qs.forEach((q,i)=>{
        const s = document.createElement('button'); s.className='step'; s.type='button'; s.setAttribute('aria-label', (lang==='fr'? '√âtape ':'Step ')+(i+1));
        if(i===stepIndex) s.classList.add('active');
        if(completed.has(i)) s.classList.add('completed');
        s.textContent = completed.has(i)? '‚úì' : (i+1);
        s.addEventListener('click', ()=>{ saveCurrent(); stepIndex = i; renderStepContent(); updatePreview(); });
        container.appendChild(s);
      });
    }

    // render question
    function renderStepContent(){
      const container = el('stepContent'); container.innerHTML='';
      const qs = Q[lang]; const q = qs[stepIndex];

      const wrapper = document.createElement('div'); wrapper.className='question';
      const title = document.createElement('h3'); title.id='questionTitle'; title.textContent = q.title; wrapper.appendChild(title);

      let input;
      if(q.type==='textarea'){
        input = document.createElement('textarea'); input.id='currentAnswer'; input.placeholder = q.placeholder || '';
        input.value = answers[q.id] || '';
        input.addEventListener('keydown', onKeyDown);
      } else if(q.type==='options'){
        input = document.createElement('div'); input.className='options-grid'; input.id='currentAnswer';
        q.options.forEach(opt => {
          const b = document.createElement('button'); b.type='button'; b.className='option-btn'; b.textContent = opt; b.addEventListener('click', ()=>{ answers[q.id]=opt; Array.from(input.children).forEach(c=>c.classList.remove('active')); b.classList.add('active'); });
          if(answers[q.id]===opt) b.classList.add('active');
          input.appendChild(b);
        });
      } else {
        input = document.createElement('input'); input.id='currentAnswer'; input.type = q.type==='number'?'number':'text'; input.placeholder = q.placeholder || '';
        input.value = answers[q.id] || '';
        input.addEventListener('keydown', onKeyDown);
      }

      wrapper.appendChild(input);
      container.appendChild(wrapper);
      setTimeout(()=>{ const cur = el('currentAnswer'); if(cur && cur.focus) cur.focus(); },60);
      renderSteps(); updateControls();
    }

    // keyboard next on Enter (except textarea)
    function onKeyDown(e){ if(e.key === 'Enter' && e.target.tagName !== 'TEXTAREA'){ e.preventDefault(); el('nextBtn').click(); } }

    function saveCurrent(){
      const qs = Q[lang]; const q = qs[stepIndex]; const cur = el('currentAnswer');
      if(!cur) return;
      if(q.type==='options'){
        // already stored on click
      } else {
        answers[q.id] = cur.value && cur.value.trim ? cur.value.trim() : cur.value;
      }
      if(answers[q.id] && answers[q.id] !== '') completed.add(stepIndex);
      renderSteps(); updateControls();
    }

    // controls
    function updateControls(){
      const prev = el('prevBtn'); const next = el('nextBtn'); prev.disabled = stepIndex===0;
      const qs = Q[lang];
      if(stepIndex === qs.length-1){ next.innerHTML = (lang==='fr'? 'Terminer ‚úì':'Finish ‚úì'); } else { next.innerHTML = (lang==='fr'? 'Suivant ‚Üí':'Next ‚Üí'); }
    }

    el('prevBtn').addEventListener('click', ()=>{ saveCurrent(); if(stepIndex>0) stepIndex--; renderStepContent(); updatePreview(); });
    el('nextBtn').addEventListener('click', ()=>{ saveCurrent(); const qs = Q[lang]; if(stepIndex < qs.length-1){ stepIndex++; renderStepContent(); updatePreview(); } else { finish(); } });

    // preview grid
    function updatePreview(){
      const age = parseInt(el('inputAge').value) || 0; const death = parseInt(el('inputDeath').value) || 80;
      const total = Math.max(1, death) * 52; const lived = Math.max(0, age) * 52; const grid = el('gridPreview'); grid.innerHTML='';
      // limit number of cells created on very large death ages for perf
      const maxCells = (window.innerWidth < 480) ? Math.min(total, 26*2) : Math.min(total, 52*2);
      const step = Math.ceil(total / maxCells);
      for(let i=0; i<total; i+=step){ const c = document.createElement('div'); c.className='cell'; if(i<lived) c.classList.add('past'); if(i>=lived && i<lived+step) c.classList.add('now'); grid.appendChild(c);} 
      const percent = Math.round((lived/total)*100); el('quickPercent').textContent = percent + '%'; el('quickLeft').textContent = Math.max(0,total - lived) + (lang==='fr'? ' semaines restantes':' weeks remaining');
    }
    el('inputAge').addEventListener('input', updatePreview); el('inputDeath').addEventListener('input', updatePreview);

    // finish and show report
    function finish(){ saveCurrent(); const name = el('inputName').value || (lang==='fr'? 'Ami':'Friend'); const age = parseInt(el('inputAge').value)||0; const death = parseInt(el('inputDeath').value)||80; const total = death*52; const lived = age*52; const percent = Math.round((lived/total)*100);
      const reg = answers['q_regret']||''; const loved = answers['q_loved']||''; const dream = answers['q_dream']||''; const project = answers['q_project']||''; const pride = answers['q_pride']||''; const habit = answers['q_habit']||''; const commit = answers['q_commit']||'';

      let summary = ''; if(reg) summary += (lang==='fr'? `Ton regret majeur : "${reg}". ` : `Your major regret: "${reg}". `); else summary += (lang==='fr'? "Tu n'as pas pr√©cis√© de regret principal. R√©fl√©chis-y." : "You didn't specify a main regret. Reflect on it.");
      if(dream) summary += (lang==='fr'? ' Tu as un r√™ve en t√™te ‚Äî commence par un pas minuscule.' : ' You have a dream ‚Äî start with a tiny step.'); else summary += (lang==='fr'? ' Si tu n\'as pas de r√™ve, commence par explorer des curiosit√©s.' : ' If you have no dream, start by exploring curiosities.');

      const actions = []; if(dream) actions.push(lang==='fr'? '√âcris le premier micro-pas pour ton r√™ve aujourd\'hui.' : 'Write the first micro-step for your dream today.'); if(habit) actions.push((lang==='fr'? 'Mets en place : ':'Start: ') + habit); else actions.push(lang==='fr'? 'Choisis une habitude simple (ex: marcher 20 min).' : 'Choose a simple habit (e.g. walk 20 min).'); if(commit) actions.push((lang==='fr'? 'Premier pas: ':'First step: ') + commit); actions.push(lang==='fr'? 'R√©serve 30 minutes cette semaine pour planifier 1 an / 5 ans.' : 'Reserve 30 minutes this week to plan 1 year / 5 years.');

      const advPoolFr = ["Vous avez encore du temps ‚Äî agissez maintenant.","Les petits pas constants battent la motivation intermittente.","Parlez √† une personne proche aujourd'hui ‚Äî la connexion change tout.","1 habitude, 30 jours ‚Äî testez et observez la diff√©rence."]; const advPoolEn = ["You still have time ‚Äî act now.","Small consistent steps beat intermittent motivation.","Talk to someone close today ‚Äî connection matters.","One habit, 30 days ‚Äî try it and observe the change."]; const adv = (lang==='fr'? advPoolFr:advPoolEn)[Math.floor(Math.random()*4)];

      // build report DOM
      const reportCard = el('reportCard'); reportCard.style.display='block'; const reportContent = el('reportContent'); reportContent.innerHTML='';
      const head = document.createElement('div'); head.innerHTML = `<strong>${lang==='fr'? 'Rapport de vie pour':'Life report for'} ${name}</strong><p>${lang==='fr'? 'Vous avez d√©j√† v√©cu ':'You have lived '}${lived} ${lang==='fr'? 'semaines (':'weeks ('}${percent}% )</p>`; reportContent.appendChild(head);
      const summ = document.createElement('p'); summ.textContent = summary; reportContent.appendChild(summ);
      const ul = document.createElement('ul'); actions.forEach(a=>{ const li=document.createElement('li'); li.textContent = a; ul.appendChild(li); }); reportContent.appendChild(ul);
      el('finalAdvice').textContent = adv;

      // save snapshot locally
      try{ const arr = JSON.parse(localStorage.getItem('life_mirror_snapshots')||'[]'); arr.unshift({date:new Date().toISOString(), name, lang, age, death, percent, answers}); localStorage.setItem('life_mirror_snapshots', JSON.stringify(arr.slice(0,20))); }catch(e){}

      reportCard.scrollIntoView({behavior:'smooth'});
    }

    // download JSON
    el('downloadJSON').addEventListener('click', ()=>{
      try{ const arr = JSON.parse(localStorage.getItem('life_mirror_snapshots')||'[]'); const blob = new Blob([JSON.stringify(arr[0]||{},null,2)],{type:'application/json'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='life_mirror_report.json'; a.click(); URL.revokeObjectURL(url);}catch(e){}
    });

    // restart
    el('restart').addEventListener('click', ()=>{ location.reload(); });

    // init
    setLang('fr'); renderSteps(); renderStepContent(); updatePreview(); updateStaticTexts();
  </script>
</body>
</html>
